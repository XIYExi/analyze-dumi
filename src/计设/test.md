---

order: 3
group:
  order:3

---

# 测试报告

本文档用于说明测试计划以及展示方案。


## 项目背景

Envelope 低代码整合平台，拥有面向H5和模板开发的原生引擎，同时整合Lowcode Engine 以及 AntV 图引擎进行二次开发，致力于低代码辅助简化开发流程。Envelope的理念偏向于构建快速原型，可以提供预览、快速出样、出码等功能，同时采用JSON schema进行配置，简单只管的就可以了解到元件的排列方式。

对于Lowcode Engine以及AntV二次开发的模块在集成进来后具有不可见行，同时阿里团队以及对齐产品进行过测试，因此项目中不在进行不必要的测试，更多会使用**黑盒测试法**，去查看交互界面是否准确等,主要测试内容如下：
- 测试插件是否正常执行
- 测试人机交互界面是否正确显示

而自主研发的原生渲染引擎，其核心工具包对于我们可见，其项目结构对于我们可见，并且提供了完全的设计图，所以采用**白盒测试法**，将着重测试以下内容：
- 测试渲染引擎中重要通路
- 测试核心依赖包中重要工具类的执行与返回
- 测试出码模块

而Envelope提供了自主研发的UI框架Love Letter UI，并封装了Ant Design以及Semantic UI作为低代码的组件物料，所以需要对自主编写的组件以及二次封装的组件进行测试，采用的测试方法为**单元测试**以及**组件展示**的形式，主要测试内容如下：
- 使用junit单元测试工具包测试Love Letter UI
- 使用umi内置test工具测试二次封装组件库
- 使用storybook展示Love Letter UI，并支持调配参数
- 使用dumi展示二次封装组件库，如Ant Design和Semantic UI




## 测试人员及安排

> 下述表格中，简写了部分名词，以下是我们的约定：
> - Envelope 表示核心渲染引擎
> - Lowcode表示基于Lowcode Engine二次开发的低代码引擎
> - AntV表示基于AntV X6图引擎开发的流程图引擎
> - Antd表示二次封装的Ant Design组件库
> - Semantic表示二次封装的Semantic UI React组件库
> - Lole表示自主研发的Love Letter UI组件库。

|测试模块|测试人员|测试平台|测试时间|备注|
|---|---|---|---|---|
|Envelope 核心工具包|范竞元|@umi/test|动态引擎开发完成后即刻测试|白盒测试，必须保证所有执行通路准确|
|Envelope FormRender 用户控制器渲染|范竞元|@umi/test|engine-core开发完成后|白盒测试，主要测试判断同时以及返回的渲染结果|
|Envelope utils 核心工具包|范竞元|@umi/test|单元测试，查看测试的返回的结果是否准确|
|Envelope 出码模块开发测试|周夕|umi+控制台|预计3月20号，出码模块开发完成后|出码模块开发难度较大并且开发周期长，测试与开发应该同步进行，编写测试页面，使用人机交互的形式查看控制台打印|
|Envelope 出码模块集成测试|范竞元|@umi/test|4月初|出码模块开发完成并通过初步测试后，测试对于三大ui框架的数据导出是否准确|
|Lowcode 插件测试|刘陆豪|@umi/test|2月中||
|Lowcode 人机交互页面|刘陆豪|umi|2月底||
|AntV 人机页面交互|周夕|umi|4月初||
|Antd 单元测试|刘陆豪|@umi/test|3月~4月||
|Semantic 单元测试|刘陆豪|@umi/test|3月~4月||
|Lole 单元测试|周夕|jest|3月~4月||
|Antd 组件库展示编写|刘陆豪|dumi|3月~4月||
|Semantic 组件库展示编写|刘陆豪|dumi|3月~4月||
|Lole 组件库展示编写|周夕|storybook|3月~4月||


## 版本风险

Envelope低代码整合平台采用webpack作为包管理器，所有依赖的配置均集中在```package.json```中，在测试中可能会遇到以下问题：

### 不同系统之间人机交互界面不同
Envelope原生引擎与Lowcode二次开发后的引擎页面风格不同，这是正常现象，Envelope是我们自主研发的低代码引擎，有Envelope风格的**组件展示侧边栏**、**用户控制器**以及**画布**。而Lowcode与AntV相比是一个较为完善的低代码渲染引擎，它将渲染引擎核心、组件展示侧边栏、用户控制器等模块均暴露出来，并且内部数据交互使用的schema与我们的格式不同，并无法做到组件通用，所以Lowcode使用的交互界面与原生引擎有差别。

但是AntV则不同，AntV图引擎只是一个提供了接口的渲染核心，并不提供其余的交互组件，并且不规定交互数据的格式，所以AntV的页面风格包括交互逻辑都是和Envelope原生引擎一致的。

### 风格问题
低代码引擎部分（包括三大引擎）和两个封装的组件库都是同一个项目下，可以使用umi自带的test工具进行测试，而Lole是单独项目开发，使用create-react-app，默认集成的是jest进行单元测试。

不同框架下不同的测试工具可能会造成一定的测试差距，理论上应该进行风格统一。但是UI框架是通用css样式以及简单js交互，并不会对重要通路造成影响，即使是不同的测试工具，只要能完成渲染任务，并且在基本的交互下不会产生问题，其影响允许忽略不计。

同时Lole采用npm打包发布，支持开箱即用，支持按需导入，即使在umi项目中也可以进行二次测试，但鉴于项目工程量较大，开发周期短，暂不安排@umi/test下的二次测试。


### 版本控制
严格控制版本，BUG以版本为单位进行提交。在测试过程中及BUG确认阶段禁止任何代码更新。所有代码提交到GitHub代码仓库，并且在开发手册是记录测试中问题，开发中如果遇到任何依赖问题，**优先与开发者沟通，严禁在不经过开发者同意下私自修改package.json中的任何依赖**。

> 如果确定是版本问题，请自行创建副本项目，在本地环境下进行修改！package.json中每一个包依赖都有严格的版本控制，不同包之间存在相互依赖关系，如果擅自添加或者擅自修改版本，可能会导致意想不到的错误，严重者可能会导致项目崩溃（如Lowcode Engine的babel依赖问题）！

### 测试时间不足
Envelope项目开发周期短，项目体量大，后期项目测试特别是在UI框架部分可能会发生测试时间不足问题。如果测试时间不足，则优先完成渲染引擎测试，其后是UI组件的单元测试，至于组件库如果时间不允许则后续找时间再编写。

因此，测试优先级安排如下：
- Envelope 核心渲染包
- Envelope工具类
- Lowcode 相关测试
- 二次封装组件库测试
- Lole 组件库测试
- 组件库展示页面编写
- AntV 相关测试

> 需要注意AntV的发布时间原先定于省赛之后（4月下旬），但是实际开发时间花费不长，虽然在省赛前完成开发，但是并没有时间再进充分测试，好在AntV的一些通用交互组件，如：**HeadComponet**、**用户控制器**、**组件展示侧边栏**均为原生引擎组件，所以在Envelope核心渲染包中均经过测试，一定程度上保证了AntV的测试，之后如果有时间则对AntV进行内部通路测试以及集成测试。

## 测试内容

由于项目体量大，并且项目测试需要根据实际函数、组件、页面进行测试。光是封装组件库就涉及到60+组件，如果全部介绍将会导致文档篇幅臃肿，这里则对部分测试内容简单说明。

---

[![ppHyq8s.md.png](https://s1.ax1x.com/2023/04/09/ppHyq8s.md.png)](https://imgse.com/i/ppHyq8s)

上图是对封装组件库的测试文档，存放在test文件夹中，使用分栏展示，左侧栏是部分测试文件代码，右侧是组件源码。

attr为测试用的默认样式，是AButton封装组件的config属性。之后使用@umi/test的测试方法进行测试。分为两个测试用例，分别测试isTpl为false和true的情况，当为false则表示此时组件是供组件展示侧边栏展示使用，应该渲染图片，此时查询是否为img标签，并且查询alt缺省时显示文本是否对应（每个组件的alt均不同，由于alt是必填属性，所以这里的作用等同于id）。当为true时表示组件被画布渲染，此时查询内部button标签，先进行样式上的基础判断，通过查询内部文本以及id判断组件是否被正确渲染，之后再依次判断如鼠标移入、鼠标点击、点击回调等。

---

[![ppH6GsP.md.png](https://s1.ax1x.com/2023/04/09/ppH6GsP.md.png)](https://imgse.com/i/ppH6GsP)

上述代码是Lole的测试，使用原生jest进行测试，语法上同@umi/test类似（@umi/test内置jest，本质上是jest的变种）,此时测试不同尺寸下文本的位置。

---

[![ppH6Jqf.md.png](https://s1.ax1x.com/2023/04/09/ppH6Jqf.md.png)](https://imgse.com/i/ppH6Jqf)

上图是Lole的组件展示编写，使用storybook框架，支持快速定义以及组件预览，允许用户修改样式以及参数，下图是组件展示页面：

[![ppH6Bzn.md.png](https://s1.ax1x.com/2023/04/09/ppH6Bzn.md.png)](https://imgse.com/i/ppH6Bzn)

storybook页面中可以在左侧选择具体的组件，在画布上预览当前组件的渲染效果，底部的控制台中输入参数，由storybook控制传递，可以实时的查看修改后的效果。

---

[![ppH62oF.md.png](https://s1.ax1x.com/2023/04/09/ppH62oF.md.png)](https://imgse.com/i/ppH62oF)

上图是封装组件库的dumi展示页面，由于不能像storybook动态的控制参数，所以采用像首图那样手动编写代码的形式进行测试，此dumi界面展示时组件均以通过测试，主要供用户进行快速的组件预览，并查看暴露出的参数。




